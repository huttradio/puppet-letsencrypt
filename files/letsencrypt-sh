#!/bin/sh

dir="$(dirname $0)"
config="${dir}/config.sh"
letsconfig_sh="${dir}/letsencrypt.sh"

########################

ca="${1}"
basedir="${2}"
wellknown="${3}"

email="${4}"
domain="${5}"

csr_path="${6}"

########################

# Save the letsencrypt.sh configuration file.
cat > "${config}" << EOF
CHALLENGETYPE="http-01"
CA="${ca}"
BASEDIR="${basedir}"
WELLKNOWN="${wellknown}"
CONTACT_EMAIL="${email}"
EOF

# Sign the certificate signing request.
"${letsconfig_sh}" --config "${config}" --domain "${domain}" --signcsr "${csr_path}" || exit $?

# Generate the certificates.
"${letsconfig_sh}" --config "${config}" --domain "${domain}" --cron || exit $?
